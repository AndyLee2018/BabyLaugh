-- 一次性上涨所有人的工资，一部门15%，二部门22%，三部门39%，最高工资不超过5000；
DECLARE
   CURSOR CUR_EMP IS SELECT * FROM EMP;
BEGIN
   FOR CUR_ROW IN CUR_EMP LOOP
       IF CUR_ROW.DEPTNO = 10 THEN
         IF CUR_ROW.SAL * 1.15 < 5000 THEN
         	UPDATE EMP SET SAL = SAL * 1.15 WHERE DEPTNO = CUR_ROW.DEPTNO;
         ELSE
         	UPDATE EMP SET SAL = 5000 WHERE DEPTNO = CUR_ROW.DEPTNO;
         END IF;
       ELSEIF CUR_ROW.DEPTNO = 20 THEN
         IF CUR_ROW.SAL * 1.22 < 5000 THEN
         	UPDATE EMP SET SAL = SAL * 1.22 WHERE DEPTNO = CUR_ROW.DEPTNO;
         ELSE
         	UPDATE EMP SET SAL = 5000 WHERE DEPTNO = CUR_ROW.DEPTNO;
         END IF;
       ELSEIF CUR_ROW.DEPTNO = 30 THEN
         IF CUR_ROW.SAL * 1.39 < 5000 THEN
         	UPDATE EMP SET SAL = SAL * 1.39 WHERE DEPTNO = CUR_ROW.DEPTNO;
         ELSE
         	UPDATE EMP SET SAL = 5000 WHERE DEPTNO = CUR_ROW.DEPTNO;
         END IF;
       END IF;
   END LOOP
EXCEPTION
	IF OTHERS THEN
		DBMS_OUTPUT.PUTLINE('异常！');
		ROLLBACK;
	ELSE
		NULL;
	END IF
END;
/